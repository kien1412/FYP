Adapted from the original code of the IALM algorithm
