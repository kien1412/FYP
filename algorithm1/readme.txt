Adapted from the original code of IALM algorithm
